<section id="listado-eventos" class="bg-white/5 border border-white/10 rounded-2xl p-6 md:p-8">
    <!-- Header -->
    <div
        class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6 pb-4 border-b border-white/10">
        <h2 class="flex items-center gap-3 text-white text-lg md:text-xl font-bold uppercase tracking-wide">
            <span class="material-symbols-outlined">list</span>
            Listado de Eventos
        </h2>
        <span class="bg-[#b7ff00]/10 text-[#b7ff00] px-4 py-1.5 rounded-full text-sm font-semibold">
            Total: {{ filteredEvents().length }}
        </span>
    </div>

    <!-- Filtros -->
    <div class="flex flex-col lg:flex-row gap-4 mb-6">
        <!-- B√∫squeda -->
        <div class="flex-1 relative">
            <span class="absolute left-4 top-1/2 -translate-y-1/2 text-white/40">üîç</span>
            <input type="text" placeholder="Buscar por nombre del evento..." [ngModel]="searchQuery()"
                (ngModelChange)="searchQuery.set($event); currentPage.set(1)"
                class="w-full bg-white/5 border border-white/10 rounded-lg py-3 pl-11 pr-4 text-white text-sm placeholder-white/40 focus:outline-none focus:border-[#b7ff00] focus:bg-[#b7ff00]/5 transition-all">
        </div>

        <!-- Dropdowns -->
        <div class="flex flex-wrap gap-3 items-center">
            <select [ngModel]="selectedCity()" (ngModelChange)="selectedCity.set($event); currentPage.set(1)"
                class="bg-white/5 border border-white/10 rounded-lg py-3 pl-4 pr-9 text-white text-sm cursor-pointer min-w-[130px] focus:outline-none focus:border-[#b7ff00] text-center appearance-none bg-no-repeat bg-size-[20px] bg-position-[right_8px_center]"
                style="background-image: url('data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 height=%2224%22 viewBox=%220 -960 960 960%22 width=%2224%22 fill=%22white%22%3E%3Cpath d=%22M480-360 280-560h400L480-360Z%22/%3E%3C/svg%3E');">
                <option value="" class="bg-[#1a1a1a] text-left">Ciudad</option>
                @for (city of cities(); track city) {
                <option [value]="city" class="bg-[#1a1a1a] text-left">{{ city }}</option>
                }
            </select>

            <select [ngModel]="selectedLocation()" (ngModelChange)="selectedLocation.set($event); currentPage.set(1)"
                class="bg-white/5 border border-white/10 rounded-lg py-3 pl-4 pr-9 text-white text-sm cursor-pointer min-w-[130px] focus:outline-none focus:border-[#b7ff00] text-center appearance-none bg-no-repeat bg-size-[20px] bg-position-[right_8px_center]"
                style="background-image: url('data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 height=%2224%22 viewBox=%220 -960 960 960%22 width=%2224%22 fill=%22white%22%3E%3Cpath d=%22M480-360 280-560h400L480-360Z%22/%3E%3C/svg%3E');">
                <option value="" class="bg-[#1a1a1a] text-left">Ubicaci√≥n</option>
                @for (loc of uniqueLocations(); track loc) {
                <option [value]="loc" class="bg-[#1a1a1a] text-left">{{ loc }}</option>
                }
            </select>

            <select [ngModel]="selectedMonth()" (ngModelChange)="selectedMonth.set($event); currentPage.set(1)"
                class="bg-white/5 border border-white/10 rounded-lg py-3 pl-4 pr-9 text-white text-sm cursor-pointer min-w-[120px] focus:outline-none focus:border-[#b7ff00] text-center appearance-none bg-no-repeat bg-size-[20px] bg-position-[right_8px_center]"
                style="background-image: url('data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 height=%2224%22 viewBox=%220 -960 960 960%22 width=%2224%22 fill=%22white%22%3E%3Cpath d=%22M480-360 280-560h400L480-360Z%22/%3E%3C/svg%3E');">
                <option value="" class="bg-[#1a1a1a] text-left">Mes</option>
                <option value="1" class="bg-[#1a1a1a] text-left">Enero</option>
                <option value="2" class="bg-[#1a1a1a] text-left">Febrero</option>
                <option value="3" class="bg-[#1a1a1a] text-left">Marzo</option>
                <option value="4" class="bg-[#1a1a1a] text-left">Abril</option>
                <option value="5" class="bg-[#1a1a1a] text-left">Mayo</option>
                <option value="6" class="bg-[#1a1a1a] text-left">Junio</option>
                <option value="7" class="bg-[#1a1a1a] text-left">Julio</option>
                <option value="8" class="bg-[#1a1a1a] text-left">Agosto</option>
                <option value="9" class="bg-[#1a1a1a] text-left">Septiembre</option>
                <option value="10" class="bg-[#1a1a1a] text-left">Octubre</option>
                <option value="11" class="bg-[#1a1a1a] text-left">Noviembre</option>
                <option value="12" class="bg-[#1a1a1a] text-left">Diciembre</option>
            </select>

            <select [ngModel]="selectedYear()" (ngModelChange)="selectedYear.set($event); currentPage.set(1)"
                class="bg-white/5 border border-white/10 rounded-lg py-3 pl-4 pr-9 text-white text-sm cursor-pointer min-w-[100px] focus:outline-none focus:border-[#b7ff00] text-center appearance-none bg-no-repeat bg-size-[20px] bg-position-[right_8px_center]"
                style="background-image: url('data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 height=%2224%22 viewBox=%220 -960 960 960%22 width=%2224%22 fill=%22white%22%3E%3Cpath d=%22M480-360 280-560h400L480-360Z%22/%3E%3C/svg%3E');">
                <option value="" class="bg-[#1a1a1a] text-left">A√±o</option>
                @for (year of availableYears(); track year) {
                <option [value]="year" class="bg-[#1a1a1a] text-left">{{ year }}</option>
                }
            </select>
        </div>
    </div>

    <!-- Tabla o Estado -->
    @if (loading()) {
    <div class="min-h-[200px] flex items-center justify-center">
        <p class="text-white/50">Cargando eventos...</p>
    </div>
    } @else if (error()) {
    <div class="min-h-[200px] flex items-center justify-center">
        <p class="text-red-400">{{ error() }}</p>
    </div>
    } @else if (paginatedEvents().length === 0) {
    <div class="min-h-[200px] flex items-center justify-center">
        <p class="text-white/50">No hay eventos que coincidan con los filtros</p>
    </div>
    } @else {
    <!-- Tabla de Eventos -->
    <div class="overflow-x-auto">
        <table class="w-full table-fixed">
            <thead>
                <tr class="border-b border-white/10 text-white/60 text-sm uppercase tracking-wide">
                    <!-- Evento - Ordenable (35%) -->
                    <th class="text-left py-4 px-2 w-[35%]">
                        <button (click)="sortByColumn('name')"
                            class="flex items-center gap-2 font-medium hover:text-[#b7ff00] transition-colors cursor-pointer"
                            [class.text-[#b7ff00]]="isColumnActive('name')">
                            Evento
                            <span class="text-xs" [class.opacity-40]="!isColumnActive('name')">{{ getSortIcon('name')
                                }}</span>
                        </button>
                    </th>

                    <!-- Fecha - Ordenable (15%) -->
                    <th class="text-left py-4 px-2 w-[15%]">
                        <button (click)="sortByColumn('date')"
                            class="flex items-center gap-2 font-medium hover:text-[#b7ff00] transition-colors cursor-pointer"
                            [class.text-[#b7ff00]]="isColumnActive('date')">
                            Fecha
                            <span class="text-xs" [class.opacity-40]="!isColumnActive('date')">{{ getSortIcon('date')
                                }}</span>
                        </button>
                    </th>

                    <!-- Ubicaci√≥n - No ordenable (18%) -->
                    <th class="text-left py-4 px-2 font-medium hidden md:table-cell w-[18%]">Ubicaci√≥n</th>

                    <!-- Estado - No ordenable (17%) -->
                    <th class="text-left py-4 px-2 font-medium hidden lg:table-cell w-[17%]">Estado</th>

                    <!-- Acciones (15%) -->
                    <th class="text-right py-4 px-2 font-medium w-[15%]">Acciones</th>
                </tr>
            </thead>
            <tbody>
                @for (event of paginatedEvents(); track event.id) {
                <tr [class]="isEventActive(event) 
                    ? 'border-b border-[#b7ff00]/30 bg-[#b7ff00]/5 hover:bg-[#b7ff00]/10 transition-colors'
                    : isEventPast(event)
                        ? 'border-b border-white/5 bg-white/1 hover:bg-white/5 transition-colors opacity-60'
                        : 'border-b border-white/5 hover:bg-white/5 transition-colors'">
                    <!-- Evento (imagen + nombre + status) -->
                    <td class="py-4 px-2">
                        <div class="flex items-center gap-3">
                            <div class="relative">
                                <img [src]="event.coverPhoto" [alt]="event.eventName"
                                    class="w-12 h-12 rounded-lg object-cover bg-white/10 shrink-0">
                                <!-- Status indicator dot -->
                                @if (isEventActive(event)) {
                                <span
                                    class="absolute -top-1 -right-1 w-3 h-3 bg-[#b7ff00] rounded-full border-2 border-[#0a0a0a] animate-pulse"></span>
                                }
                            </div>
                            <div class="min-w-0">
                                <div class="flex items-center gap-2 flex-wrap">
                                    <p class="text-white font-semibold text-sm truncate">{{ event.eventName }}</p>
                                    <!-- Event Status Badge -->
                                    @if (!event.isPublished) {
                                    <span
                                        class="bg-yellow-500/20 text-yellow-400 px-1.5 py-0.5 rounded text-[10px] font-bold shrink-0">BORRADOR</span>
                                    }
                                    @if (isEventActive(event)) {
                                    <span
                                        class="bg-[#b7ff00] text-black px-1.5 py-0.5 rounded text-[10px] font-bold shrink-0">EN
                                        VIVO</span>
                                    } @else if (isEventPast(event)) {
                                    <span
                                        class="bg-white/10 text-white/40 px-1.5 py-0.5 rounded text-[10px] font-medium shrink-0">PASADO</span>
                                    }
                                </div>
                                <p class="text-white/50 text-xs truncate">{{ event.dj.djApodo }}</p>
                            </div>
                        </div>
                    </td>

                    <!-- Fecha -->
                    <td class="py-4 px-2">
                        <p class="text-white text-sm">{{ formatDate(event.beginDatetime) }}</p>
                        <p class="text-white/50 text-xs">{{ formatTime(event.beginDatetime) }}</p>
                    </td>

                    <!-- Ubicaci√≥n -->
                    <td class="py-4 px-2 hidden md:table-cell">
                        <p class="text-white text-sm truncate">{{ event.location.locationName }}</p>
                        <p class="text-white/50 text-xs truncate">{{ event.location.city.cityName }}</p>
                    </td>

                    <!-- Estado -->
                    <td class="py-4 px-2 hidden lg:table-cell">
                        @if (event.isPublished) {
                        <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs font-medium">
                            ‚úÖ PUBLICADO
                        </span>
                        } @else {
                        <span class="bg-yellow-500/20 text-yellow-400 px-2 py-1 rounded text-xs font-medium">
                            üìù BORRADOR
                        </span>
                        }
                    </td>

                    <!-- Acciones -->
                    <td class="py-4 px-2">
                        <div class="flex justify-end gap-1">
                            <button (click)="viewGallery(event)"
                                class="relative p-2 hover:bg-white/10 rounded-lg transition-colors cursor-pointer group"
                                [ngClass]="{'text-[#b7ff00]': event.isGalleryPublished, 'text-white/60': !event.isGalleryPublished}"
                                [title]="event.isGalleryPublished ? 'üì¢ Galer√≠a publicada' : 'üì¶ Galer√≠a archivada'">
                                üñºÔ∏è
                                <!-- Visual Indicator for Published Status -->
                                <span *ngIf="event.isGalleryPublished"
                                    class="absolute top-1 right-1 w-2.5 h-2.5 bg-[#b7ff00] rounded-full border border-black/50 shadow-sm"></span>
                            </button>
                            <button (click)="viewStats(event)"
                                class="p-2 hover:bg-white/10 rounded-lg transition-colors text-white/60 hover:text-[#b7ff00] cursor-pointer"
                                title="Ver estad√≠sticas">
                                üìä
                            </button>
                            <button (click)="editEvent(event)"
                                class="p-2 hover:bg-white/10 rounded-lg transition-colors text-white/60 hover:text-[#b7ff00] cursor-pointer"
                                title="Editar">
                                ‚úèÔ∏è
                            </button>
                            <button (click)="deleteEvent(event)"
                                class="p-2 hover:bg-red-500/20 rounded-lg transition-colors text-white/60 hover:text-red-400 cursor-pointer"
                                title="Eliminar">
                                üóëÔ∏è
                            </button>
                        </div>
                    </td>
                </tr>
                }
            </tbody>
        </table>
    </div>
    }

    <!-- Paginaci√≥n -->
    <div class="flex flex-col md:flex-row justify-between items-center gap-4 mt-6 pt-6 border-t border-white/10">
        <span class="text-white/50 text-sm">
            Mostrando {{ paginatedEvents().length }} de {{ filteredEvents().length }} eventos
        </span>
        <div class="flex items-center gap-2">
            <button (click)="prevPage()" [disabled]="currentPage() === 1"
                class="bg-white/5 border border-white/10 text-white py-2 px-4 rounded-lg text-sm hover:bg-[#b7ff00]/10 hover:border-[#b7ff00] hover:text-[#b7ff00] transition-all cursor-pointer disabled:opacity-40 disabled:cursor-not-allowed disabled:hover:bg-white/5 disabled:hover:border-white/10 disabled:hover:text-white">
                Anterior
            </button>

            @for (page of [].constructor(totalPages()); track $index) {
            <button (click)="currentPage.set($index + 1)"
                [class]="currentPage() === $index + 1 
            ? 'bg-[#b7ff00] text-black font-bold py-2 px-4 rounded-lg text-sm cursor-pointer' 
            : 'bg-white/5 border border-white/10 text-white py-2 px-4 rounded-lg text-sm hover:bg-[#b7ff00]/10 hover:border-[#b7ff00] hover:text-[#b7ff00] transition-all cursor-pointer'">
                {{ $index + 1 }}
            </button>
            }

            <button (click)="nextPage()" [disabled]="currentPage() === totalPages() || totalPages() === 0"
                class="bg-white/5 border border-white/10 text-white py-2 px-4 rounded-lg text-sm hover:bg-[#b7ff00]/10 hover:border-[#b7ff00] hover:text-[#b7ff00] transition-all cursor-pointer disabled:opacity-40 disabled:cursor-not-allowed disabled:hover:bg-white/5 disabled:hover:border-white/10 disabled:hover:text-white">
                Siguiente
            </button>
        </div>
    </div>
</section>