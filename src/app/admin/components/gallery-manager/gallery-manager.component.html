<div class="min-h-screen bg-linear-to-b from-[#0a0a0a] to-[#111111]">
    <!-- Header -->
    <nav
        class="flex justify-between items-center px-4 md:px-8 py-4 bg-black/80 backdrop-blur-md border-b border-[#b7ff00]/20 sticky top-0 z-50">
        <div class="flex-1">
            <button (click)="goBack()"
                class="inline-flex items-center gap-2 text-white no-underline text-sm px-4 py-2 rounded-lg transition-all hover:bg-[#b7ff00]/10 hover:text-[#b7ff00] cursor-pointer bg-transparent border-none">
                <span class="text-xl">‚Üê</span>
                <span class="hidden md:inline">Volver al Listado</span>
            </button>
        </div>
        <div class="flex-none">
            <span
                class="bg-linear-to-r from-[#b7ff00] to-[#7acc00] text-black px-4 py-1.5 rounded-full font-bold text-xs tracking-wider">
                GALER√çAS
            </span>
        </div>
        <div class="flex-1"></div>
    </nav>

    <main class="px-4 md:px-8 py-8 max-w-6xl mx-auto">
        <!-- Title + Status Toggle -->
        <div class="mb-8 flex flex-col md:flex-row md:items-start md:justify-between gap-4">
            <div>
                <h1 class="text-3xl md:text-4xl font-extrabold text-white mb-2 uppercase tracking-wider">
                    Gestionar
                    <span class="text-[#b7ff00] italic">Galer√≠a</span>
                </h1>
                <p class="text-white/60 text-lg">
                    {{ eventName() || 'Cargando...' }}
                </p>
                <p class="text-white/40 text-sm mt-1">
                    Sube, organiza y publica las fotos oficiales del evento.
                </p>
            </div>

            <!-- Gallery Status Toggle -->
            <div
                class="bg-white/5 border border-white/10 rounded-xl p-4 flex flex-col items-center gap-3 min-w-[200px]">
                <div class="flex items-center gap-2">
                    @if (isPublished()) {
                    <span class="w-3 h-3 rounded-full bg-[#b7ff00] animate-pulse"></span>
                    <span class="text-[#b7ff00] font-medium text-sm uppercase">Publicada</span>
                    } @else {
                    <span class="w-3 h-3 rounded-full bg-white/30"></span>
                    <span class="text-white/50 font-medium text-sm uppercase">Archivada</span>
                    }
                </div>
                <button (click)="toggleGalleryStatus()" [disabled]="updatingStatus()"
                    [class]="isPublished() 
                        ? 'w-full px-4 py-2 rounded-lg text-sm font-medium transition-all cursor-pointer border-none bg-white/10 text-white/70 hover:bg-white/20'
                        : 'w-full px-4 py-2 rounded-lg text-sm font-medium transition-all cursor-pointer border-none bg-[#b7ff00] text-black hover:bg-[#c8ff33]'">
                    @if (updatingStatus()) {
                    <span>Actualizando...</span>
                    } @else if (isPublished()) {
                    <span>üì• Archivar Galer√≠a</span>
                    } @else {
                    <span>üöÄ Publicar Galer√≠a</span>
                    }
                </button>
            </div>
        </div>

        <!-- Error Message -->
        @if (error()) {
        <div class="mb-6 bg-red-500/10 border border-red-500/30 rounded-xl p-4 flex items-center gap-3">
            <span class="text-red-400">‚ö†Ô∏è</span>
            <p class="text-sm text-red-400">{{ error() }}</p>
            <button (click)="error.set(null)"
                class="ml-auto text-red-400 hover:text-red-300 cursor-pointer bg-transparent border-none">‚úï</button>
        </div>
        }

        <!-- Upload Zone -->
        <section class="bg-white/5 border border-white/10 rounded-2xl p-6 md:p-8 mb-8">
            <div (dragover)="onDragOver($event)" (dragleave)="onDragLeave($event)" (drop)="onDrop($event)"
                [class]="isDragOver() 
                    ? 'border-2 border-dashed border-[#b7ff00] rounded-xl p-8 flex flex-col items-center justify-center text-center bg-[#b7ff00]/10 transition-all'
                    : 'border-2 border-dashed border-white/20 rounded-xl p-8 flex flex-col items-center justify-center text-center hover:border-[#b7ff00]/50 hover:bg-white/5 transition-all'">

                @if (uploading()) {
                <div class="w-full max-w-md">
                    <div class="w-16 h-16 rounded-full bg-[#b7ff00]/20 flex items-center justify-center mb-4 mx-auto">
                        <span class="text-3xl">üì§</span>
                    </div>
                    <p class="text-white font-medium mb-1 text-center">Subiendo im√°genes...</p>
                    <p class="text-[#b7ff00] font-bold text-2xl text-center mb-3">{{ uploadProgress() }}%</p>
                    <!-- Progress Bar -->
                    <div class="w-full bg-white/10 rounded-full h-3 overflow-hidden">
                        <div class="bg-linear-to-r from-[#b7ff00] to-[#7acc00] h-full rounded-full transition-all duration-300 ease-out"
                            [style.width.%]="uploadProgress()">
                        </div>
                    </div>
                    <p class="text-xs text-white/40 mt-2 text-center">Por favor espera, no cierres esta p√°gina</p>
                </div>
                } @else {
                <div class="w-16 h-16 rounded-full bg-[#b7ff00]/20 flex items-center justify-center mb-4">
                    <span class="text-3xl text-[#b7ff00]">‚òÅÔ∏è</span>
                </div>
                <p class="text-white font-medium mb-1">Arrastra y suelta tus fotos aqu√≠</p>
                <p class="text-xs text-white/40 mb-4">Soporta im√°genes de alta resoluci√≥n (JPG, PNG, WEBP). Tama√±o
                    m√°ximo por archivo: 25MB.</p>
                <label
                    class="bg-white/10 hover:bg-white/20 text-white px-6 py-2 rounded-lg cursor-pointer transition-colors font-medium text-sm">
                    Seleccionar Archivos
                    <input type="file" accept="image/*" multiple (change)="onFileSelected($event)" class="hidden">
                </label>
                }
            </div>
        </section>

        <!-- Gallery Grid -->
        <section class="bg-white/5 border border-white/10 rounded-2xl p-6 md:p-8">
            <!-- Header -->
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                <div class="flex items-center gap-3">
                    <h2 class="text-white text-lg font-bold uppercase tracking-wide flex items-center gap-2">
                        <span>üñºÔ∏è</span>
                        Im√°genes Cargadas
                    </h2>
                    <span class="bg-white/10 text-white/60 px-2 py-0.5 rounded text-xs">
                        {{ images().length }} archivos
                    </span>
                </div>

                @if (images().length > 0) {
                <div class="flex items-center gap-2">
                    <button (click)="selectAll()"
                        class="text-xs text-white/60 hover:text-white px-3 py-1.5 rounded-lg hover:bg-white/10 transition-colors cursor-pointer bg-transparent border border-white/10">
                        {{ allSelected() ? 'Deseleccionar Todo' : 'Seleccionar Todo' }}
                    </button>
                    @if (hasSelection()) {
                    <button (click)="deleteSelected()"
                        class="text-xs bg-red-500/20 text-red-400 hover:bg-red-500/30 px-3 py-1.5 rounded-lg transition-colors cursor-pointer border border-red-500/30 font-medium">
                        Eliminar Selecci√≥n ({{ selectionCount() }})
                    </button>
                    }
                </div>
                }
            </div>

            <!-- Loading -->
            @if (loading()) {
            <div class="flex items-center justify-center py-12">
                <p class="text-white/60">Cargando galer√≠a...</p>
            </div>
            } @else if (images().length === 0) {
            <!-- Empty State -->
            <div class="flex flex-col items-center justify-center py-12 text-center">
                <div class="w-20 h-20 rounded-full bg-white/5 flex items-center justify-center mb-4">
                    <span class="text-4xl text-white/20">üì∑</span>
                </div>
                <p class="text-white/40 mb-1">No hay im√°genes en esta galer√≠a</p>
                <p class="text-white/30 text-sm">Arrastra fotos o usa el bot√≥n para empezar</p>
            </div>
            } @else {
            <!-- Image Grid -->
            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
                @for (image of images(); track image.id) {
                <div (click)="toggleSelection(image.id)"
                    [class]="isSelected(image.id) 
                        ? 'relative aspect-square rounded-xl overflow-hidden cursor-pointer ring-2 ring-[#b7ff00] ring-offset-2 ring-offset-[#111111]'
                        : 'relative aspect-square rounded-xl overflow-hidden cursor-pointer hover:ring-2 hover:ring-white/30 transition-all group'">
                    <img [src]="image.cloudinaryUrl" [alt]="image.originalName" class="w-full h-full object-cover">

                    <!-- Selection Overlay -->
                    @if (isSelected(image.id)) {
                    <div class="absolute inset-0 bg-[#b7ff00]/20 flex items-center justify-center">
                        <div class="w-8 h-8 rounded-full bg-[#b7ff00] flex items-center justify-center">
                            <span class="text-black text-lg">‚úì</span>
                        </div>
                    </div>
                    }

                    <!-- Delete Button (visible on hover) -->
                    <button (click)="deleteSingleImage(image.id, $event)"
                        class="absolute top-2 right-2 bg-black/70 hover:bg-red-500 text-white p-1.5 rounded-lg opacity-0 group-hover:opacity-100 transition-all cursor-pointer border-none">
                        üóëÔ∏è
                    </button>

                    <!-- Filename -->
                    <div class="absolute bottom-0 left-0 right-0 bg-linear-to-t from-black/80 to-transparent p-2">
                        <p class="text-white text-[10px] truncate">{{ image.originalName }}</p>
                    </div>
                </div>
                }
            </div>
            }
        </section>
    </main>
</div>